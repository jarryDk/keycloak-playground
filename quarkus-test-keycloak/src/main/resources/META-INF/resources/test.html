<!DOCTYPE html>
<head>
    <title>keycloak-spa</title>
    <script src="lib/axios.js"></script>
    <script src="lib/keycloak.min.js"></script>
    <script>

        var keycloak = new Keycloak(
            {
                "url": "https://keycloak.jarry.dk:8543",
                "realm": "jarry",
                "clientId": "todo-service",
                "redirect_uri" : "https://update.jarry.dk:8443/api/users/me"
            }
        );

        keycloak.init({onLoad: 'login-required'})
            .then( function (response) {
                 console.log('User is now authenticated.');
            }).catch(function (error) {
                console.log( 'We hava an error');
                window.location.reload();
            });

        function makeAjaxRequest() {
            axios.get("/api/users/me", {
                headers: {
                    'Authorization': 'Bearer ' + keycloak.token
                }
            })
            .then( function (response) {
                console.log("Response: ", response.status);
                console.log("Payload: ", response.data)
            }).catch(function (error) {
                console.log('refreshing');
                keycloak.updateToken(5).then(function () {
                    console.log('Token refreshed');
                }).catch(function () {
                    console.log('Failed to refresh token');
                    window.location.reload();
                });
            });
    }
    </script>
</head>
<body>
    <button onclick="makeAjaxRequest()">Request</button>
</body>
</html>